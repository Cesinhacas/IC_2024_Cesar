#include <stdio.h>
#include <stdlib.h>
#include <math.h>

double mx[] = {-0.171885943485398,-0.0728220100713066,0.109448402938341,0.278277338172266,0.434613668024841,0.575329443167342,0.668238295917995,0.725551676701048,0.748297655812237,0.722778060541899,0.67100507626242,0.570767672008338,0.450776315133883,0.28582440101464,0.109819448184572,-0.0739979666265674,-0.269336684274573,-0.458355231812985,-0.628530464509512,-0.79083047186086,-0.916080825573948,-1.01705273258912,-1.07317931881584,-1.08957271330809,-1.07565307050369,-1.01360966556797,-0.928469288881203,-0.786576506966774,-0.648780277633607,-0.459663339084943,-0.276469762744698,-0.0733668578867947,0.0989340259244187,0.285693260173739,0.436998030766797,0.562037042979683,0.659700982524744,0.713254986716978,0.73599746493729,0.718645428547708,0.653059022670452,0.569979416413008,0.436684287145932,0.271292367688891,0.106843521416044,-0.0763227957668998,-0.268675805525915,-0.440448309553288,-0.622684573428428,-0.791967720873729,-0.905211823209201,-0.996645077606236,-1.06011659485467,-1.07307967949344,-1.07354856319921,-0.99848017875512,-0.904107509963174,-0.783900752591739,-0.621228614586927,-0.450630202319354,-0.254298063181883,-0.0786261812816333,0.087963752241022,0.268695187167347,0.409337238353537,0.526419941124637,0.609694146752309,0.675530371290133,0.682904598574622,0.668031472692757,0.618898471647364,0.527181147619696,0.412925446731703,0.252457405728156,0.0935568334795093,-0.0829637803645375,-0.266641725302447,-0.44448338668113,-0.599595380689031,-0.750233189175172,-0.871633346941879,-0.967957814655863,-1.02098874373128,-1.03873182766976,-1.0313780738568,-0.964486512238103,-0.874160625272092,-0.745117212018482,-0.601044272884568,-0.437957262883556,-0.263191774748708,-0.0858221157470764,0.0708245088524986,0.236070363377014,0.363074356847226,0.483548024762513,0.54732880058205,0.611453819512323,0.634604813512183,0.609975581874512,0.550974542696448,0.461707678471603,0.366324200536449,0.221184242112219,0.0693443117719982,-0.0872452830441861,-0.25604020562818,-0.423507926925637,-0.563584321210397,-0.7054912511571,-0.807822140767291,-0.909704270828188,-0.957883013444406,-0.974705025637051,-0.952097683985653,-0.903848698895505,-0.814144674552316,-0.71088287552982,-0.578421813906166,-0.41865182723967,-0.248046605894535,-0.0967838110539593,0.0392974856244977,0.174463375785965,0.307395783445258,0.393635297111329,0.466824574087853,0.523271026888669,0.533955410959524,0.51667615850484,0.465503767628032,0.401195609220656,0.283732423164669,0.183569137008452,0.0435095297865869,-0.100138726589172,-0.248652099018726,-0.384737174279914,-0.526131899089355,-0.643825429091829,-0.739192221791864,-0.820627608303524,-0.871059203863673,-0.87578044920483,-0.866575749883606,-0.82299357639024,-0.752403890863013,-0.645947975115938,-0.526673398302907,-0.38379081186013,-0.235579193356298,-0.0982638834565757,0.0126172510183613,0.127506821198015,0.222494782594584,0.308365910959636,0.371047061724002,0.402856102755036,0.416764979274647,0.396327394698572,0.363008846120613,0.310902502875904,0.218836431563737,0.118750424768193,0.00978537429023774,-0.117248018916215,-0.241167889584627,-0.354449789644325,-0.479387798947774,-0.569547295656029,-0.659717677435995,-0.711791790623015,-0.763864054176806,-0.764952085602101,-0.753110940277914,-0.709604133710252,-0.649222378188142,-0.56667059195333,-0.46315263463237,-0.356855094176598,-0.239439148436333,-0.118761585855381,-0.0315065196482203,0.063791129621062,0.138340219957033,0.200519064088164,0.244659562311061,0.275347052282875,0.289870797037318,0.281236914719698,0.260263406164606,0.194813213649436,0.14249238097375,0.0524442121875325,-0.034495462241727,-0.112899861837838,-0.220097154046362,-0.319464673913551,-0.402076346278534,-0.490290214674598,-0.534715757466811,-0.586685148208151,-0.633633092033877,-0.642551383799141,-0.61628236292231,-0.595622312360866,-0.546361392900132,-0.482718722044909,-0.397861672115358,-0.301623912272745,-0.218322073819625,-0.137856046562721,-0.0739731983133689,-0.00774646049199825,0.0283843265796569,0.08377516638297,0.0932277912386331,0.128169639747634,0.138644478903101,0.133843839997833,0.115888761218288,0.0876057561908039,0.0409854823399612,-0.0137157098137703,-0.0712803550760313,-0.147326871177005,-0.203180374037889,-0.274266189468787,-0.330051063780797,-0.385062225168379,-0.418585077927601,-0.459822489552979,-0.488948860520344,-0.484135548465579,-0.491360527218242,-0.461803271664238,-0.424991606374084,-0.382636379375628,-0.320079875268852,-0.268260012116094,-0.208310406848257,-0.150226378334603,-0.127246537412673,-0.0880275432686394,-0.0554568249319839,-0.0424978871303527,-0.0190935538381807,-0.0245123668776022,-0.0101069327383267,-0.0181751246811607,-0.0294329234092671,-0.0410381155807455,-0.0669028768815968,-0.084464461702901,-0.110994345944934,-0.161133588528672,-0.191863946202393,-0.220515176035818,-0.25114666883483,-0.285751367219466,-0.30611493947387,-0.319513528547939,-0.322885718906127,-0.321003059828925,-0.317261184639417,-0.319323408782767,-0.304493970487894,-0.281821193429366,-0.251761776238372,-0.226954595465603,-0.199115910610822,-0.188285781776334,-0.167259643133768,-0.172542338809419,-0.165111373315465,-0.16861391556798,-0.173069860125752,-0.16023094470617,-0.163602824183094,-0.177791436566072,-0.17311418852607,-0.166085391152858,-0.186192429656066,-0.176134936173033,-0.175247968663637,-0.18151019808949,-0.171738145483806,-0.178421526134272,-0.176945482560643,-0.172443709532274,-0.173224452063143,-0.175285983978163,-0.169484656836888,-0.17029368085959,-0.179033256562022,-0.174768399827503,-0.171383782915974,-0.182970311329453,-0.166753598755996,-0.167290069221955,-0.172544865571459,-0.19345344992983,-0.233169444105379,-0.250966615234157,-0.26816613913182,-0.305275231583328,-0.318031896524514,-0.330120981425338,-0.326867705197986,-0.326405422242544,-0.324583627030433,-0.29483761511977,-0.281059826977972,-0.245536823119093,-0.219414046578537,-0.17858451755318,-0.161677867919291,-0.118354674849963,-0.0863248322321304,-0.0594486975910775,-0.0481211436421943,-0.0314933091009221,-0.00619691666664833,-0.00905825734782189,-0.015431891246687,-0.0362502133642741,-0.0442395006404593,-0.0617409335083942,-0.0899293018080331,-0.124021714781511,-0.162952163010801,-0.208144525500433,-0.261188826207329,-0.333795044325702,-0.381706088602365,-0.428477104570445,-0.452776082104967,-0.484771606935027,-0.490568483792523,-0.481923931076637,-0.478032322747767,-0.420952816974901,-0.381717280706266,-0.33532019059441,-0.274466438134238,-0.204409111514647,-0.1371931924343,-0.07948110097347,-0.0127041264850604,0.0365900696788742,0.0912658484216524,0.122469291142575,0.128628915758617,0.137194663748789,0.139415635745826,0.120213944781277,0.087167036318633,0.0425496279381496,-0.0176998577600856,-0.0736333472790007,-0.134228677942184,-0.217477101061146,-0.314044644679135,-0.398859881106753,-0.48796928669348,-0.550371536618766,-0.596165834847448,-0.624784709558226,-0.630423833359145,-0.622107371176832,-0.596226503353059,-0.552464469921466,-0.49230540118243,-0.399021618355448,-0.315727506624173,-0.208590148239111,-0.127872466375602,-0.0253715384745159,0.0590367574160228,0.133573555827409,0.19455427880744,0.253612467169113,0.284802605643741,0.292742107906852,0.283859504718948,0.251589824088933,0.198000997121658,0.140975238861825,0.0522755575440207,-0.0265919512692158,-0.126968594671067,-0.24392882189212,-0.360288138241303,-0.469889211510882,-0.582943557805819,-0.654719964263768,-0.714307610128279,-0.747326340692938,-0.77333990106576,-0.748101122801561,-0.711766714627132,-0.654724291565062,-0.567227667182561,-0.455699836394495,-0.363241569522485,-0.242313130439227,-0.106303717628343,0.00876087043113122,0.110486144134318,0.227332603877926,0.29882967527244,0.367221185663035,0.401374694805636,0.425455274145971,0.405621148262954,0.369578475435684,0.299075603845662,0.218385012983703,0.130787299910302,0.0104147019794054,-0.110419411068156,-0.24310263775566,-0.390982373983644,-0.534912170826969,-0.648710908582839,-0.741604460409503,-0.829788274697663,-0.860925447300899,-0.870519738582155,-0.864787007083201,-0.813846858026946,-0.736210090255835,-0.645114023918977,-0.53547465487256,-0.388700958465543,-0.243830364396035,-0.092945925466368,0.0415988276546854,0.181915599281032,0.295746555959624,0.404908567486562,0.466647553251357,0.528291598253538,0.538445043944016,0.531487655861468,0.475718029734558,0.395428734907068,0.303588860320249,0.180774676994371,0.0460175153508695,-0.0922424041206978,-0.259501816733188,-0.405655014612862,-0.573475618508928,-0.699168267334367,-0.817230872495066,-0.897757414853187,-0.945095004603405,-0.978175023052056,-0.952518301542999,-0.903776863920914,-0.822388656335209,-0.71007784493626,-0.569319060448267,-0.415026815041112,-0.265238488938165,-0.088934351738262,0.0617196013250553,0.229938158879366,0.370088850193474,0.479694462647936,0.546870572112958,0.594693128911119,0.619388028107329,0.606877079664474,0.556073036630204,0.476233723859802,0.356264454599615,0.238390594226749,0.0715128108150365,-0.0878119833561013,-0.25724547495825,-0.442516096710815,-0.60853157626261,-0.75664775862407,-0.867748073674381,-0.969152568284241,-1.01955618909858,-1.02722249309004,-1.02360579866637,-0.963715901926898,-0.865540755180069,-0.749612070774199,-0.599139895403622,-0.445673501530017,-0.257855517230511,-0.0851368237524179,0.0875031482343614,0.270735970119687,0.399511067676055,0.522014670831423,0.617646128624138,0.667069040941055,0.688737349033701,0.683444518383398,0.623111616594592,0.525046289919086,0.411180324976718,0.269261279246993,0.0924003513175743,-0.0775294093226268,-0.276293540660447,-0.450199057060671,-0.630585467611678,-0.778682270518976,-0.8998044277475,-1.0026654819463,-1.05657136130484,-1.08950288970621,-1.06079891335608,-0.997485383217619,-0.903049423068373,-0.778569042499813,-0.620467858327215,-0.457000309250121,-0.270334563807193,-0.0744132199905022,0.110798145003719,0.291621235065576,0.432327954959528,0.568755627847614,0.645677025351996,0.715512858333979,0.737588430712884,0.718426602125668,0.653335693709958,0.563014445814705,0.435618052558847,0.272620956616791,0.111167862610066,-0.0806599803368126,-0.272115796897628,-0.466110518037516,-0.635925632941093,-0.786463343311157,-0.918452961259203,-1.01405902606822,-1.08046605655157,-1.09683515874822,-1.06834700158946,-1.01816311514295,-0.913716873216329,-0.792061301837189,-0.643932828644951,-0.453668917333464,-0.264381170641936,-0.0739448547845657,0.10641264516714,0.29264334411562,0.454058846285896,0.57367869363774,0.678689946768428,0.720702562788202,0.748540400153054,0.720265222890954,0.679853631446557,0.563594902159508,0.443282237519891,0.288323088851164,0.125761658087791,-0.0877479964854137,-0.169954608667504};

double my[] = {-0.0865201681955114,-0.074127698480419,-0.0757126920648067,-0.0737204941896378,-0.0730096186446826,-0.072430415976004,-0.0830740343933586,-0.0803028478299991,-0.0726254126845916,-0.0876938004721657,-0.0780129900045247,-0.0838986190878951,-0.0740498473906676,-0.0676437780262225,-0.0828906538515305,-0.0808964729457918,-0.0778177247883685,-0.0766927549292713,-0.0784647825317459,-0.0744049367622526,-0.0746488329040956,-0.0695948019459824,-0.0748028872766057,-0.074324952689001,-0.0664556199199147,-0.0725022569431669,-0.0720327580339699,-0.0778667977861015,-0.0696768791875667,-0.0591117473395789,-0.0747331880192544,-0.0597544956519295,-0.0373575881758183,-0.00957555967284822,0.00754819172338774,0.0326841748192396,0.045317458997124,0.0572054897972787,0.0624816509108253,0.049772238237473,0.0517981959260728,0.0310582159125924,0.0217729845925131,-0.00135327512852039,-0.0257145500076837,-0.0632138965724975,-0.0829272222881815,-0.116400656654812,-0.137834340275755,-0.162182655501593,-0.174918840806301,-0.190223575522005,-0.20177621825531,-0.20721739291396,-0.211280681219875,-0.197783086231309,-0.187826040329404,-0.166093376879262,-0.14229103206785,-0.113211434353347,-0.078915268663917,-0.0545154090123466,-0.00717740123089779,0.0525065656033467,0.105182624430875,0.130679351581806,0.157344817666851,0.188268123446305,0.186911459498842,0.179792993934659,0.167056251196731,0.125177416221422,0.0886844504769969,0.0566794533191019,-0.00370926080047363,-0.0466042698449061,-0.0931943288978267,-0.158665954578599,-0.206112892960537,-0.250738596764857,-0.284199521721243,-0.30741044737537,-0.32241594630761,-0.325622045280063,-0.335105993453764,-0.294137174933662,-0.283338055417551,-0.242895053744528,-0.224866497618333,-0.159004485484547,-0.104450637677314,-0.0275517515975195,0.0389105290208993,0.122085352581836,0.175160029878375,0.236121770658341,0.276201421246759,0.304965357626608,0.299941691491483,0.303705590529354,0.281274770415409,0.235004948153985,0.188293264422896,0.123112605562995,0.0356637638906332,-0.0364008057905028,-0.115047790927843,-0.190807809398713,-0.274939609578576,-0.332504410496894,-0.387587746336671,-0.416607460625114,-0.436966932233285,-0.447702794300145,-0.434498451428859,-0.421155151542299,-0.382683544282862,-0.341802147565281,-0.265318669161031,-0.182377221004578,-0.123831357371737,-0.019271647096896,0.0696834992303697,0.166893520937732,0.254681587062479,0.323118463853731,0.36543028840195,0.398078759239245,0.415383373214468,0.40231016082106,0.371329858072822,0.314928338127757,0.250106553959885,0.175117687709185,0.0811650546627472,-0.0143701391288419,-0.121303324902198,-0.235289155628602,-0.316594746537182,-0.395535517774746,-0.47547021539976,-0.52218726664956,-0.552146586370027,-0.552280002170909,-0.560954247710593,-0.525056908800718,-0.460320110113951,-0.396415144376321,-0.311954039711262,-0.223608707804696,-0.129906972882752,-0.0156071708992,0.104064472075911,0.231527888746165,0.30437453373235,0.393062073464697,0.462305278136079,0.493662663310105,0.513575077188375,0.496626751325637,0.462002529020707,0.388430589686729,0.314180749223275,0.229016491791652,0.107872119680541,-0.0103078927921619,-0.12831897022023,-0.25369824420595,-0.366542273013665,-0.463169187033588,-0.543811357692607,-0.603364668059954,-0.639691638896011,-0.660788447901107,-0.648379792654084,-0.604034113611901,-0.546886321944842,-0.466252776276853,-0.368714096152055,-0.253078368382898,-0.127033357111793,-0.0047562904839143,0.135594655133621,0.25250156618615,0.370672849431705,0.472398905786385,0.522764414740623,0.573254951758454,0.590596079432781,0.574839286758438,0.521177801033805,0.455494974379158,0.368525586268332,0.257913082931493,0.11405205087823,-0.00211668769639122,-0.150467986513744,-0.271427153861922,-0.412083026016464,-0.519919509134063,-0.605112898297337,-0.672642897441681,-0.72464651259765,-0.738137790749415,-0.723306230727834,-0.681120818702404,-0.61693864669168,-0.519305147719573,-0.404737713432325,-0.28009158776749,-0.150924623574504,0.00166385243571068,0.136998509823523,0.291460653470946,0.411957379492954,0.513304709356098,0.570536588061823,0.627731730164774,0.649486458465551,0.622806677817199,0.572154069751478,0.510499756481342,0.402630822503818,0.282288375150101,0.151688367318554,-0.00171238306224824,-0.146637935692902,-0.283070024113765,-0.434027037489745,-0.559844028606369,-0.652707862492066,-0.722597185508641,-0.774326885796173,-0.789656214151483,-0.782295997209797,-0.721664547411533,-0.648382133908166,-0.557242011092156,-0.429531628416864,-0.2893279880071,-0.145810748003251,-0.00434067735344821,0.159526217629573,0.293094296898352,0.422831432544026,0.529001965715186,0.612748835024514,0.659170830090891,0.669728537920081,0.649988462468708,0.602314378571943,0.530031303307068,0.427676665839003,0.304212452598712,0.157173641739526,0.00601877883467785,-0.153251570698495,-0.31056700188623,-0.463119796059569,-0.576404643583364,-0.67411959448152,-0.740583516210133,-0.809456817165221,-0.831879858013555,-0.805222300828364,-0.759065519772383,-0.683323429767704,-0.577918656183427,-0.454363595362278,-0.308277540870095,-0.158697025812972,0.0184946651623771,0.161905662641806,0.310026727466779,0.443893008723972,0.536189151848306,0.63294853102396,0.672734983770034,0.695914222142324,0.667125542430642,0.620629158057746,0.542547420140856,0.432706473183274,0.303026454105352,0.165748970037455,0.0162137322999927,-0.14441607213911,-0.303235454061658,-0.46180700376073,-0.593094970149313,-0.696471997713537,-0.765872855267725,-0.814788006342909,-0.847417335357104,-0.815976294749401,-0.780376632369509,-0.681636962881967,-0.574771576878023,-0.460131701747915,-0.303923981524978,-0.153029798643282,0.00782875270329674,0.159341691487022,0.312636600469842,0.430541526560444,0.533055955192879,0.618629933018976,0.657317231289198,0.678502676835975,0.667276469010907,0.612036738800319,0.530604091991742,0.433390745635458,0.29736794577024,0.148478250530198,-0.0026604979541679,-0.145951805570663,-0.316410856061686,-0.446639699587181,-0.577013876545851,-0.682584800868009,-0.764131439343745,-0.807596539714296,-0.819077067645697,-0.812459976159701,-0.761017650201415,-0.679180918928579,-0.580380226598735,-0.449353478696754,-0.31521593213126,-0.153110008338998,0.0107641308438496,0.151363825986818,0.285764105785897,0.413286699808838,0.498096186585205,0.588820128940624,0.627740266542234,0.628899230739263,0.632513386263963,0.580151539769397,0.504989360015487,0.411965009681562,0.297572839388797,0.142957417137397,0.00343221154809406,-0.155313803765389,-0.299562170987013,-0.43453844921372,-0.551051477775113,-0.660003035584389,-0.735321010427349,-0.782139838703762,-0.790040653006248,-0.770386777919646,-0.725629528141644,-0.664044667303247,-0.548977826995061,-0.43300707150287,-0.283845481871589,-0.142048202122496,-0.00540760075429557,0.140562501261792,0.250308607870459,0.360439222265646,0.459037965521444,0.526267243929677,0.58073163495046,0.597686273724503,0.580217132849449,0.536006993171837,0.457625892796336,0.359455760073294,0.261749361477823,0.133733796669344,-0.00522987881878148,-0.141221599530633,-0.286043332377201,-0.403264093577152,-0.526512170426041,-0.611988108145521,-0.68553113296242,-0.716133138504331,-0.737385892461966,-0.723994104379251,-0.693883826748865,-0.616758868779708,-0.520930044100018,-0.399517890363774,-0.284981689020025,-0.149085729709815,-0.0137617009454708,0.110893653143812,0.222188129613059,0.313561573089306,0.392090504345073,0.469168524311922,0.498583353916607,0.507668877807486,0.494358998741868,0.458118668040881,0.39612664665795,0.321471672985432,0.219693259618355,0.107661550630381,-0.0156362258873919,-0.123720415013362,-0.247111773870134,-0.368106414187002,-0.467381740971274,-0.533653019408438,-0.607962865507096,-0.647108803383065,-0.647588302940049,-0.663971543288268,-0.609464569528555,-0.550874393780882,-0.466380099701495,-0.362520034554012,-0.246396400870845,-0.134562675536121,-0.0210099639178745,0.072157511214895,0.167968900166951,0.257045801946744,0.326856234669434,0.381918431032905,0.413423365196537,0.422814566720887,0.414837145202902,0.391948820065741,0.324010530806017,0.249455162484799,0.179679361103616,0.0835669460665112,-0.0278099798819015,-0.130158363406975,-0.221154203105117,-0.330802793835949,-0.411220708131476,-0.481917935399176,-0.524985988636712,-0.553583356505726,-0.561311568130378,-0.556806575314834,-0.531805331363488,-0.464315816426795,-0.398106233427694,-0.328828928462522,-0.216300074543641,-0.114813973140989,-0.027381604814237,0.0498118120135436,0.120878491844009,0.18468152083201,0.227098112777106,0.277302417999629,0.307137347652896,0.315619887161508,0.302741922783527,0.285745816589236,0.233354631373573,0.176278790336402,0.130968404351529,0.044351896072064,-0.0324951041420358,-0.116365132103538,-0.1852169013075,-0.262019029082611,-0.337555302357872,-0.384602641947989,-0.422529852414124,-0.450823688139366,-0.454237453002877,-0.452525149731976,-0.422338675007473,-0.391848349589859,-0.331991448362257,-0.268659482123033,-0.192131434208339,-0.117788663923863,-0.0557116001318667,0.00573074053162184,0.0601321488508998,0.104312844100215,0.137601159477071,0.171093905656649,0.181779728189832,0.194539589940872,0.183914354036287,0.172055154261973,0.135895230757318,0.0936564788828122,0.0507047631039545,0.0013757334957573,-0.0465421328372894,-0.102366307499836,-0.160003817156067,-0.210910629100329,-0.246311119413011,-0.284030440341316,-0.319994504248222,-0.329219338872526,-0.332838827638271,-0.344376465228563,-0.314529066394972,-0.27529269476325,-0.242989790516977,-0.203068036036519,-0.156324031295106,-0.0974360917484541,-0.051933104668779,-0.023157353068911,-0.00643237415777323,0.017337328980731,0.0184893753203132,0.0462633184391862,0.0560763631511549,0.0540466718768394,0.0513841429036909,0.0498845144873324,0.0279879020437613,0.0147576476489924,-0.00788489170034232,-0.0252267330126138,-0.0627508954569088,-0.085671183716459,-0.112931982247789,-0.14295278303653,-0.157222700853029,-0.18446663476313,-0.191601962377875,-0.19990503849315,-0.213239504693762,-0.207256638866285,-0.179818487605618,-0.185635805629445,-0.182794276597166,-0.142795971862359,-0.118427504125317,-0.0953072953590368,-0.0653585952348566,-0.0729122924261629,-0.0692410590401566,-0.0745169360049467,-0.0730060711673532,-0.0791368790665778,-0.0636687575157212,-0.0594073027826571,-0.084281853185393,-0.0739604202611438,-0.0753714707616915,-0.0730871959133124,-0.078716276068165,-0.0795262200442112,-0.0812266679592055,-0.0709214658811122,-0.0844094566626528,-0.0709072944439734,-0.074532193485849,-0.0796606223849531,-0.0699652247606682,-0.0801746809628627,-0.0681104064143684,-0.0725567956409774,-0.075693787550318,-0.0787268360888034,-0.0803192135105543,-0.0802967104801794,-0.0738963187178115,-0.0653565760209052,-0.075307788244131};

double mz[] = {1.31329792508541,1.30132757894947,1.26074073470374,1.16916093305573,1.02295062008415,0.828450246210826,0.616516567132445,0.390762826747694,0.138331365420356,-0.118604959365415,-0.340854528031301,-0.559281355124304,-0.745089152020075,-0.884221259811824,-0.996172434177561,-1.04483372759447,-1.04665181272277,-0.999906331118601,-0.885376389224376,-0.738715286628185,-0.567862209340744,-0.343762798102514,-0.111666698308475,0.140979236772832,0.384212483381854,0.61904360795075,0.828674176244009,1.00391236766841,1.16457514080971,1.2552452794847,1.31154673115991,1.30664488203385,1.25183868323901,1.14849386357974,1.02248949483654,0.825969879218204,0.617857946900388,0.366711008246152,0.134186069359735,-0.109699006772158,-0.343276547864066,-0.560821520209275,-0.75881578889405,-0.878720622081472,-0.977901566090663,-1.04545352415737,-1.04385049203493,-0.995916282957152,-0.88843674087817,-0.75698838248205,-0.55521668108112,-0.343508318523787,-0.106823560264116,0.122286252323582,0.373135064644347,0.613984198520724,0.823764165891453,1.01023940529881,1.16264769227187,1.26517292014608,1.30148615715289,1.29907990275317,1.25299129249074,1.17530433538435,1.01298680855459,0.831024955405915,0.60942956921278,0.393524756461126,0.1306216707312,-0.11433334434988,-0.352425115524,-0.563399279191149,-0.742654253507914,-0.893175473967708,-0.996631341533687,-1.04382016874881,-1.04391146109146,-0.991832534595588,-0.885590610258508,-0.750366105279839,-0.567089999675404,-0.344314933185043,-0.114279227140618,0.130614194439796,0.381647250523509,0.606721772603787,0.821256787329871,1.02265652331731,1.15307140513604,1.26126515272437,1.31148062592497,1.30569798176951,1.26462086302923,1.16686893073242,1.01740976126944,0.834992713708528,0.614195745652345,0.375966155405732,0.13399695867844,-0.114217989506151,-0.345362014049294,-0.571945895894556,-0.74662752454977,-0.89393509940996,-1.00021627382826,-1.0380244101056,-1.05299044555766,-0.993702357793178,-0.891510035765565,-0.744259257180743,-0.563122734041036,-0.353955605157434,-0.106462107880441,0.130693455096325,0.394222091476822,0.622172415755032,0.828885556517109,1.01299094726076,1.17408067604436,1.25314609880282,1.30947575921687,1.3102344733596,1.25495929385459,1.15272935702709,1.01450968820428,0.830723920023141,0.602796461430495,0.379319419107268,0.129142043325566,-0.104945323887584,-0.341852661245706,-0.557615063937424,-0.736646763742108,-0.891818946920132,-0.977749276658717,-1.04607273714271,-1.04799236298548,-1.00541672832562,-0.882380077839809,-0.742965523536041,-0.560844289515429,-0.332226172740812,-0.112564395875985,0.140902617302666,0.386530708117158,0.619443174868777,0.831390900486621,1.01929052492827,1.16186509636858,1.25890507777837,1.31503542925231,1.31471016024334,1.25904120060365,1.16337938507241,1.01380583862934,0.834240452827882,0.610809857581248,0.371648389136141,0.118695826514455,-0.111798910481408,-0.341376039546185,-0.56735874884247,-0.750578361240512,-0.893630725613073,-1.00227467850565,-1.04080628644428,-1.04290277897153,-0.99396236082097,-0.899050643582803,-0.742723704465999,-0.567047249900588,-0.335736542588161,-0.110884803230275,0.137577021335883,0.378938234276491,0.623933890421128,0.824545136924571,1.01627974538966,1.15713934770092,1.27250296916324,1.31002202988375,1.30762563454756,1.26645204423057,1.14998615269265,0.996778861182366,0.826500917330661,0.602236863527975,0.37173992167195,0.127984688897352,-0.114695209544617,-0.347904130465972,-0.560882440130092,-0.73917886715109,-0.895159995217927,-0.987531449172859,-1.03472812525441,-1.04766573580695,-0.993333499316601,-0.890417485654158,-0.738897212111764,-0.558648107178586,-0.359395846507688,-0.114485015744296,0.131268476492711,0.375182278821836,0.619527490165721,0.835410222405683,1.01029718900988,1.15105775333996,1.26211888904054,1.31871291873349,1.31887174047477,1.25856871035814,1.15900577444559,1.01110653679486,0.829560438283834,0.607583926378065,0.37796553904574,0.126213214120874,-0.120406739874808,-0.351978321438629,-0.575692384031424,-0.744708070374306,-0.892355907188586,-0.99677693906127,-1.03692908470789,-1.04502309933493,-0.990896059125204,-0.88859942879122,-0.740093187070594,-0.563208791762407,-0.333453117745815,-0.111253484998876,0.133926521744382,0.379789557670482,0.614937739242745,0.833805900597665,1.02085920553532,1.16251989459338,1.25869341887771,1.3096101810656,1.31867343997642,1.25570212478711,1.15076207903651,1.00692359688728,0.827616591779127,0.622448893754018,0.371316786073718,0.119880388073269,-0.120909336397944,-0.347181857269773,-0.572777503380687,-0.760786048181909,-0.903049161649009,-1.00127481643946,-1.05174049302552,-1.04486505973826,-0.991612497949677,-0.900275083634311,-0.741496998313689,-0.551538326054342,-0.345883635357104,-0.118510146563087,0.138404431674309,0.386146685833773,0.630306381458084,0.830089999357399,1.01986160987853,1.17083965510198,1.26131505655334,1.30373975414191,1.30629241496007,1.25242422505916,1.15011423700465,1.01026891717546,0.82985252601442,0.605993559949396,0.378853146271396,0.124793327609655,-0.109453139754523,-0.350426048087549,-0.562882843688391,-0.754408466598597,-0.895255244039835,-0.983938319413535,-1.03544412837759,-1.04080583348747,-0.976594242834151,-0.881741160287545,-0.735035278942869,-0.561510718766848,-0.350270363167825,-0.112939155380335,0.142532762724559,0.38690303192501,0.627310671182029,0.833189927339488,1.01466062299453,1.16479361683907,1.26394911109965,1.3133565034502,1.3042601661552,1.25949408029992,1.16423676066052,1.01612880324708,0.815721647983943,0.605146401290299,0.371072098599808,0.134222763335069,-0.129702416623773,-0.349074218638758,-0.568581239663735,-0.747546532273216,-0.890387460076012,-0.990857850456702,-1.04699244394219,-1.04558609711394,-1.00084300277542,-0.886759020449546,-0.741437559488998,-0.5644101684467,-0.342263045089742,-0.105085679112633,0.142097309594713,0.388142513452194,0.625221157555954,0.83438613676916,1.02661271377121,1.15411067023383,1.25930465838686,1.31248319785952,1.31884688440587,1.26294778824641,1.15004038089099,1.00398536344782,0.829741455250948,0.605223466654079,0.37342546674179,0.133476100457654,-0.114698362519106,-0.346563178576945,-0.561932956980319,-0.736489943550027,-0.89163205925678,-0.991969487257812,-1.03822141747856,-1.04637446605054,-0.987736857807355,-0.894367899670949,-0.742968198876168,-0.555938693979331,-0.343314031274262,-0.116079926086701,0.137303053232113,0.386860875442646,0.6338235992301,0.835230662177146,1.02157439976936,1.16339001673259,1.2514489932507,1.30803986323968,1.30443387782383,1.25587564370181,1.15124938030183,1.00494137232958,0.816249742091479,0.60662320092015,0.375776127445484,0.13377255652972,-0.102897590643925,-0.356155520290989,-0.565491240612612,-0.748608008555057,-0.890290350975459,-0.977716245018655,-1.03469593376626,-1.04136790545409,-0.986124984159088,-0.894551004041369,-0.746599695246804,-0.55669552334673,-0.341223859957882,-0.116971592849938,0.147023504148892,0.386293361703241,0.615987626590987,0.820054638859059,1.02369856772545,1.16553507252481,1.26000345237288,1.30891237535003,1.30946502644232,1.25202426634023,1.15813202722369,1.00825805975312,0.825970954663662,0.612192922600354,0.364995619999566,0.127209260292716,-0.119906106765841,-0.358508060209673,-0.560783180413995,-0.750925933844752,-0.898360000250211,-0.995067854365505,-1.0529352577065,-1.03780834823828,-0.988169676890757,-0.887980483399966,-0.735252460583229,-0.549716423078935,-0.348355652565789,-0.101634419769956,0.136633362652621,0.382682044719713,0.615651661318447,0.846533440033352,1.00962172128233,1.16220309400215,1.26449463913522,1.3208010958335,1.31409048408486,1.26060804193215,1.16334035624802,1.00959044340804,0.823450665266085,0.608427912965364,0.369727915332424,0.130825955990438,-0.113184717735182,-0.347553891900192,-0.553890021100183,-0.748079929912729,-0.899805961200937,-0.989644992463463,-1.04346822450182,-1.04969323450252,-0.991649787882475,-0.893228489182151,-0.735438248876768,-0.556556993459248,-0.34310136059488,-0.111761041425831,0.139138172433141,0.381505139887992,0.616812571599086,0.837344709580962,1.02177643107526,1.15101586488142,1.26592747657139,1.30862719063908,1.3064192405408,1.25471491385532,1.16147253070366,1.00506458910925,0.830241054289316,0.606590954949376,0.37234716954936,0.134147604549031,-0.111280427434685,-0.348431948566431,-0.555348851679956,-0.740780802895963,-0.894106034339663,-0.989822837067623,-1.03851694622696,-1.04216594079851,-0.988074648723311,-0.887074266914931,-0.743201093687594,-0.554526195099368,-0.337244814932056,-0.115737368266425,0.144444974966443,0.394676877122115,0.616824300121657,0.832905457506398,1.02024625114585,1.16409812138426,1.27751188492732,1.31750894775377,1.30693493783149,1.25931684345045,1.16027836862096,1.0047680321367,0.831522479244337,0.610960354552969,0.381151872886732,0.131190632774166,-0.120943031676044,-0.350564182039108,-0.561332214530492,-0.75049424698686,-0.893159385220268,-0.997785197579433,-1.04079672248471,-1.03735360435515,-0.984163925008105,-0.886418147045037,-0.742300404375735,-0.551215321749426,-0.350925755503155,-0.106688068266231,0.13099256441874,0.381714667444528,0.618733611900741,0.829595481428546,1.01372440575763,1.15171308297576,1.26448402419515,1.30275952632463,1.31578033083851,1.26995887802991,1.1603473349417,1.01307507921341,0.82766387516126,0.614043113586073,0.37783400642061,0.129388268809727,-0.121440402118543,-0.341216672216117,-0.576772033747277,-0.743624623573832,-0.89104007538326,-0.991755375672066,-1.03206768089671,-1.04041808134493,-0.990438928312014,-0.894421559038181,-0.738821026993276,-0.558393606828291,-0.345423980204109,-0.110965440891455,0.133580830811893,0.373362632901699,0.620835054959645,0.820943888255069,1.00981169184577,1.16677450085875,1.25070745914986,1.31395420884643,1.31020775921327,1.26339533800189,1.16014292710109,1.01160755266881,0.819524941484713,0.614579224965725,0.38332827134771,0.139156620469921,-0.121273844795421,-0.35671491168733,-0.563892706268418,-0.738255631883113,-0.894412112682264,-0.99500142533685,-1.03661929418042,-1.04260135475637,-0.989770847783794,-0.890223377236889,-0.746391332326104,-0.55573416128431,-0.343921975795683,-0.10758415441668,0.140044658716714,0.386090977800704,0.618823695328077,0.822339180198358,1.00716024861774,1.1675933120211,1.26194630242512,1.30756199432569,-1.04712985356558};

#define N 9
#define N1 3

typedef struct 
{
    double r1;
    double r2;
    double r3;
} raizes_t;

void inverter_matriz9x9(double matriz[N][N], double inversa[N][N]) {
    // Inicializando a matriz identidade na matriz inversa
    for (int i = 0; i < N; i++) {
        for (int j = 0; j < N; j++) {
            if (i == j) {
                inversa[i][j] = 1;
            } else {
                inversa[i][j] = 0;
            }
        }
    }

    // Aplicando o método de Gauss-Jordan
    for (int i = 0; i < N; i++)
    {
        double pivot = matriz[i][i];
        for (int j = 0; j < N; j++)
        {
            matriz[i][j] /= pivot;
            inversa[i][j] /= pivot;
        }

        for (int k = 0; k < N; k++)
        {
            if (k != i)
            {
                double fator = matriz[k][i];
                for (int j = 0; j < N; j++)
                {
                    matriz[k][j] -= fator * matriz[i][j];
                    inversa[k][j] -= fator * inversa[i][j];
                }
            }
        }
    }
}

void inverter_matriz3x3(double matriz[N1][N1], double inversa[N1][N1]) {
    // Inicializando a matriz identidade na matriz inversa
    for (int i = 0; i < N1; i++) {
        for (int j = 0; j < N1; j++) {
            if (i == j) {
                inversa[i][j] = 1;
            } else {
                inversa[i][j] = 0;
            }
        }
    }

    // Aplicando o método de Gauss-Jordan
    for (int i = 0; i < N1; i++)
    {
        double pivot = matriz[i][i];
        for (int j = 0; j < N1; j++)
        {
            matriz[i][j] /= pivot;
            inversa[i][j] /= pivot;
        }

        for (int k = 0; k < N1; k++)
        {
            if (k != i)
            {
                double fator = matriz[k][i];
                for (int j = 0; j < N1; j++)
                {
                    matriz[k][j] -= fator * matriz[i][j];
                    inversa[k][j] -= fator * inversa[i][j];
                }
            }
        }
    }
}

void resolver_cubica(double a, double b, double c, double d, raizes_t *raizes)
{
    // Passo 1: Reduzindo para a forma t^3 + pt + q = 0
    double p = (3 * a * c - b * b) / (3 * a * a);
    double q = (2 * b * b * b - 9 * a * b * c + 27 * a * a * d) / (27 * a * a * a);

    // Passo 2: Calculando o discriminante
    double delta = (q / 2)*(q / 2) + (p / 3)*(p / 3)*(p / 3);

    // Passo 3: Encontrar as raízes com base no valor de delta
    if (delta == 0) {
        // Três raízes reais (pelo menos duas iguais)
        double u = cbrt(-q / 2);
        raizes->r1 = 2 * u - b / (3 * a);
        raizes->r2 = -u - b / (3 * a);
        raizes->r3 = raizes->r2;
    } else {
        // Três raízes reais diferentes
        double r = sqrt(-p / 3);
        double theta = acos(-q / (2 * r * r * r));
        raizes->r3 = 2 * r * cos(theta / 3) - b / (3 * a);
        raizes->r1 = 2 * r * cos((theta + 2 * 3.14159265358979323846) / 3) - b / (3 * a);
        raizes->r2 = 2 * r * cos((theta + 4 * 3.14159265358979323846) / 3) - b / (3 * a);
    }
}

void autovetor(double A[N1][N1], double lambda, double x[N1])
{
    double A_lambda[3][3], v[3] = {1, 1, 1}, A_lambda_inv[3][3], norma = 0;
    for(int i=0; i < 3; i++)
    {
        for(int j=0; j < 3; j++)
        {
            if(i == j)
            {
                A_lambda[i][j] = A[i][j] - lambda;
            }
            else
            {
                A_lambda[i][j] = A[i][j];
            }
        }
    }
    inverter_matriz3x3(A_lambda, A_lambda_inv);
    for(int i=0; i < 3; i++)
    {
        x[i] = 0;
        for(int j=0; j < 3; j++)
        {
            x[i] += A_lambda_inv[i][j]*v[j];
        }
    }

    for(int i=0; i < 3; i++)
    {
        norma += x[i]*x[i];
    }
    norma = sqrt(norma);
    for(int i=0; i < 3; i++)
    {
        x[i] /= norma;
    }
}


void SVD_dec(double A[N1][N1], double U[N1][N1], double S[N1][N1])
{
    double a, b, c, d;
    raizes_t raizes;
    double AU1[3], AU2[3], AU3[3]; 

    a = -1;
    b = A[0][0] + A[1][1] + A[2][2];
    c = -A[0][0]*A[1][1] - A[0][0]*A[2][2] - A[1][1]*A[2][2] + A[0][1]*A[1][0] + A[0][2]*A[2][0] + A[0][2]*A[2][0];
    d = A[0][0]*A[1][1]*A[2][2] + A[0][1]*A[1][2]*A[2][0] + A[0][1]*A[1][0]*A[2][1] - A[0][1]*A[1][0]*A[2][2] - A[1][2]*A[2][1]*A[0][0] - A[0][2]*A[2][0]*A[1][1];

    resolver_cubica(a, b, c, d, &raizes);
    S[0][0] = raizes.r1;
    S[0][1] = 0;
    S[0][2] = 0;
    S[1][1] = raizes.r2;
    S[1][0] = 0;
    S[1][2] = 0;
    S[2][2] = raizes.r3;
    S[2][0] = 0;
    S[2][1] = 0;

    autovetor(A, raizes.r1, AU1);
    autovetor(A, raizes.r2, AU2);
    autovetor(A, raizes.r3, AU3);
    

    U[0][0] = -AU1[0];
    U[0][1] = -AU1[1];
    U[0][2] = -AU1[2];
    U[1][0] = -AU2[0];
    U[1][1] = -AU2[1];
    U[1][2] = -AU2[2];
    U[2][0] = AU3[0];
    U[2][1] = AU3[1];
    U[2][2] = AU3[2];
}

void salva(double A[N1][N1+1])
{
    FILE *file = fopen("/mnt/c/Users/labt5/OneDrive/Desktop/Cesar/IC_2024_Cesar/Dados/Calib_param_TW_c.csv", "w");
    for(int i=0; i < N1; i++)
    {
        for(int j=0; j <= N1; j++)
        {
            fprintf(file, "%.15lf,", A[i][j]);
        }
        fprintf(file, "\n");
    }
}

void main()
{
    int tam1 = (sizeof(mx)/sizeof(double));
    #define tam tam1
    
    int passo_max = 200;
    int passo = 0, loop = 1;
    double stop = 10e-24;
    double H[tam], Sigma_noise[3][tam];
    double z_k[tam], mu_k[tam], sigma_k[tam], L_k[9][tam], sigma_bar = 0;
    double z_bar = 0, mu_bar = 0, L_bar[9] = {0, 0, 0, 0, 0, 0, 0, 0, 0};
    double z_tilde[tam], mu_tilde[tam], L_tilde[9][tam];
    double F_tt[9][9], F_tt_copy[9][9], P_tt[9][9];
    double theta[9] = {0, 0, 0, 0, 0, 0, 0, 0, 0}, theta1[9] = {0, 0, 0, 0, 0, 0, 0, 0, 0};
    double TS_erro = 0, c[3], E[3][3], E_inv[3][3], tmp[3][3], dJdThetap_tilde[9], dbsqdtheta_p[9], dJdThetap_bar[9], dJdThetap_bar_scalar = 0, dJdTheta[9], F_tt_bar[9][9], F_tt_bar_copy[9][9], F_tt_bar_vet[9], F_tt_bar_inv[9][9], theta_np1[9], E_inv_c[3] = {0, 0, 0};
    double ABC[9] = {0, 0, 0, 0, 0, 0, 0, 0, 0};
    double U[3][3], S[3][3], W[3][3], D[3][3], D_copy[3][3], h[3], D_inv[3][3];


    for(int i=0; i < tam; i++)
    {
        H[i] = 1.0f/2;
        Sigma_noise[0][i] = 0.006*0.006;
        Sigma_noise[1][i] = 0.006*0.006;
        Sigma_noise[2][i] = 0.006*0.006;
        z_k[i] = pow(sqrt(mx[i]*mx[i] + my[i]*my[i] + mz[i]*mz[i]), 2) - H[i]*H[i];
        mu_k[i] = -(Sigma_noise[0][i] + Sigma_noise[1][i] + Sigma_noise[2][i]);
        sigma_k[i] = 4*(mx[i]*mx[i]*Sigma_noise[0][i] + my[i]*my[i]*Sigma_noise[1][i] + mz[i]*mz[i]*Sigma_noise[2][i]) + 2*(Sigma_noise[0][i]*Sigma_noise[0][i] + Sigma_noise[1][i]*Sigma_noise[1][0] + Sigma_noise[2][i]*Sigma_noise[2][i]);
        sigma_bar += 1/sigma_k[i];
        L_k[0][i] = 2*mx[i];
        L_k[1][i] = 2*my[i];
        L_k[2][i] = 2*mz[i];
        L_k[3][i] = -(mx[i]*mx[i]);
        L_k[4][i] = -(my[i]*my[i]);
        L_k[5][i] = -(mz[i]*mz[i]);
        L_k[6][i] = -2*mx[i]*my[i];
        L_k[7][i] = -2*mx[i]*mz[i];
        L_k[8][i] = -2*my[i]*mz[i];
    }
    sigma_bar = 1/sigma_bar;
    
    for(int i=0; i < tam; i++)
    {
        z_bar += z_k[i]*sigma_bar/sigma_k[i];
        mu_bar += mu_k[i]*sigma_bar/sigma_k[i];
        for(int j=0; j < 9; j++)
        {
            L_bar[j] += L_k[j][i]*sigma_bar/sigma_k[i];
        }
    }

    for(int i=0; i < tam; i++)
    {
        z_tilde[i] = z_k[i] - z_bar;
        mu_tilde[i] = mu_k[i] - mu_bar;
        for(int j=0; j < 9; j++)
        {
            L_tilde[j][i] = L_k[j][i] - L_bar[j];
        }
    }

    for(int i=0; i < 9; i++)
    {
        for(int j=0; j < 9; j++)
        {
            F_tt[i][j] = 0;
            F_tt_copy[i][j] = 0;
            P_tt[i][j] = 0;
        }
    }

    for(int i=0; i < tam; i++)
    {
        for(int j=0; j < 9; j++)
        {
            for(int k=0; k < 9; k++)
            {
                F_tt[j][k] += (L_tilde[j][i]*L_tilde[k][i])/sigma_k[i];
                F_tt_copy[j][k] = F_tt[j][k];
            }
        }
    }

    inverter_matriz9x9(F_tt_copy, P_tt);

    for(int i=0; i < 9; i++)
    {
        for(int j=0; j < tam; j++)
        {
            theta1[i] += ((z_tilde[j]-mu_tilde[j])*L_tilde[i][j])/sigma_k[j];
        }
    }
    for(int i=0; i < 9; i++)
    {
        for(int j=0; j < 9; j++)
        {
            theta[j] += P_tt[i][j]*theta1[i];
        }
    }

    
    for(int i=0; i < 9; i++)
    {
        for(int j=0; j < tam; j++)
        {
            ABC[i] -= ((z_tilde[j]-mu_tilde[j])*L_tilde[i][j])/sigma_k[j];
        }
    }

    while(loop == 1)
    {
        if(passo != 0)
        {
            for(int i=0; i < 9; i++)
            {
                theta[i] = theta_np1[i];
            }
        }
        
        c[0] = theta[0];
        c[1] = theta[1];
        c[2] = theta[2];

        E[0][0] = theta[3] + 1;
        E[0][1] = theta[6];
        E[0][2] = theta[7];
        E[1][0] = theta[6];
        E[1][1] = theta[4] + 1;
        E[1][2] = theta[8];
        E[2][0] = theta[7];
        E[2][1] = theta[8];
        E[2][2] = theta[5] + 1;

        inverter_matriz3x3(E, E_inv);

        //Cálculo do vetor E_inv * c
        for(int i=0; i < 3; i++)
        {
            E_inv_c[i] = (E_inv[0][i] + E_inv[1][i] + E_inv[2][i])*c[i];
        }

        //Cálculo da matriz tmp = E_inv * c * E_inv * c
        for(int i=0; i < 3; i++)
        {
            for(int j=0; j < 3; j++)
            {
                tmp[i][j] = E_inv_c[i]*E_inv_c[j];
            }
        }

        //Cálculo do vetor dJdThetap_tilde
        for(int i=0; i < 9; i++)
        {
            dJdThetap_tilde[i] = ABC[i];
            for(int j=0; j < 9; j++)
            {
                dJdThetap_tilde[i] += F_tt[i][j]*theta[j];
            }
        }

        //Cálculo do vetor dbsqdtheta_p
        dbsqdtheta_p[0] = 2*E_inv_c[0];
        dbsqdtheta_p[1] = 2*E_inv_c[1];
        dbsqdtheta_p[2] = 2*E_inv_c[2];
        dbsqdtheta_p[3] = -tmp[0][0];
        dbsqdtheta_p[4] = -tmp[1][1];
        dbsqdtheta_p[5] = -tmp[2][2];
        dbsqdtheta_p[6] = -2*tmp[0][1];
        dbsqdtheta_p[7] = -2*tmp[0][2];
        dbsqdtheta_p[8] = -2*tmp[1][2];

        //Cálculo do vetor dJdThetap_bar
        dJdThetap_bar_scalar = 0;
        for(int i=0; i < 9; i++)
        {
            dJdThetap_bar_scalar -= L_bar[i]*theta[i];
        }
        for(int i=0; i < 3; i++)
        {
            dJdThetap_bar_scalar += c[i]*E_inv_c[i];
        }
        dJdThetap_bar_scalar = dJdThetap_bar_scalar - mu_bar + z_bar;
        dJdThetap_bar_scalar = dJdThetap_bar_scalar*(-1/sigma_bar);
        for(int i=0; i < 9; i++)
        {
            dJdThetap_bar[i] = dJdThetap_bar_scalar*(L_bar[i] - dbsqdtheta_p[i]);
        }

        //Cálculo do vetor dJdTheta
        for(int i=0; i < 9; i++)
        {
            dJdTheta[i] = dJdThetap_tilde[i] + dJdThetap_bar[i];
        }

        //Cálculo da matriz F_tt_bar
        for(int i=0; i < 9; i++)
        {
            F_tt_bar_vet[i] = (L_bar[i] - dbsqdtheta_p[i]);
        }
        for(int i=0; i < 9; i++)
        {
            for(int j=0; j < 9; j++)
            {
                F_tt_bar[i][j] = (F_tt_bar_vet[i]*F_tt_bar_vet[j])/sigma_bar + F_tt[i][j];
                F_tt_bar_copy[i][j] = F_tt_bar[i][j];
            }
        }

        //Cálculo do vetor theta_np1
        inverter_matriz9x9(F_tt_bar_copy, F_tt_bar_inv);
        for(int i=0; i < 9; i++)
        {
            theta_np1[i] = theta[i];
            for(int j=0; j < 9; j++)
            {
                theta_np1[i] -= F_tt_bar_inv[i][j]*dJdTheta[j];
            }
        }

        //Cálculo do erro
        TS_erro = 0;
        for(int i=0; i < 9; i++)
        {
            for(int j=0; j < 9; j++)
            {
                TS_erro += (theta_np1[i] - theta[i])*F_tt_bar[i][j]*(theta_np1[j] - theta[j]);
            }
        }


        if(passo > passo_max || TS_erro < stop)
        {
            loop = 0;
        }
        passo += 1;
    }
    c[0] = theta[0];
    c[1] = theta[1];
    c[2] = theta[2];

    E[0][0] = theta[3];
    E[0][1] = theta[6];
    E[0][2] = theta[7];
    E[1][0] = theta[6];
    E[1][1] = theta[4];
    E[1][2] = theta[8];
    E[2][0] = theta[7];
    E[2][1] = theta[8];
    E[2][2] = theta[5];

    // Segundo passo, encontrando os parâmetros
    SVD_dec(E, U, S);

    for(int i=0; i < 3; i++)
    {
        for(int j=0; j < 3; j++)
        {
            if(i == j)
            {
                W[i][j] = -1 + sqrt(S[i][j] + 1);
            }
            else
            {
                W[i][j] = 0;
            }
        }
    }

    for(int i=0; i < 3; i++)
    {
        for(int j=0; j < 3; j++)
        {
            D[j][i] = 0;
            for(int k=0; k < 3; k++)
            {
                D[j][i] += U[k][i]*W[k][j];
            }
        }
    }

    for(int i=0; i < 3; i++)
    {
        for(int j=0; j < 3; j++)
        {
            D_copy[i][j] = 0;
            for(int k=0; k < 3; k++)
            {
                D_copy[i][j] += D[k][i]*U[k][j];
            }
        }
    }    

    for(int i=0; i < 3; i++)
    {
        for(int j=0; j < 3; j++)
        {
            D[i][j] = D_copy[i][j];
            if(i == j)
            {
                D_copy[i][j] += 1;
            }
        }
    }

    inverter_matriz3x3(D_copy, D_inv);

    for(int i=0; i < 3; i++)
    {
        h[i] = 0;
        for(int j=0; j < 3; j++)
        {
            h[i] += D_inv[i][j]*c[j];
        }
    }
    
    printf("Os parâmetros são: \n%f\n%f\n%f\n", h[0], h[1], h[2]);
    printf("\n");
    printf("A matriz D é:\n");
    for(int i=0; i < 3; i++)
    {
        for(int j=0; j < 3; j++)
        {
            printf("%f ", D[i][j]);
        }
        printf("\n");
    }

    printf("\n");
    printf("Convergiu em %d passos\n", passo);

    double param_calib[N1][N1+1];
    for(int i=0; i < N1; i++)
    {
        param_calib[i][0] = h[i];
    }
    for(int i=0; i < N1; i++)
    {
        for(int j=0; j < N1; j++)
        {
            param_calib[i][j+1] = D[i][j];
        }
    }

    salva(param_calib);
}